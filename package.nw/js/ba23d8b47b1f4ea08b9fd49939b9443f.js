'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(){m.removeAudio(),n.removeAudio(),x.resetNetworkStatus(),y.clearAuthorizeQueue()}function b(a){const b={scene:p.SCENE_DEFAULT,path:'',query:{}};if(a&&a.condiction)b.path=a.condiction.pathName||'',b.query=a.condiction.query||{},b.scene=a.condiction.scene||p.SCENE_DEFAULT;else{const a=g.getCompileCondiction();if(a){const c=a.query&&a.query.split('&')||[];c.forEach((a)=>{if(a){const c=a.split('=');b.query[c[0]]=c[1]||''}else b.query['']=''}),a.pathName&&(b.path=a.pathName);const d=b.scene=a.scene||p.SCENE_DEFAULT;if(d==p.SCENE_SHARE_TICKET&&(b.shareInfo=a.shareInfo),(d==p.SCENE_MINI_PROGRAM||d==p.SCENE_MINI_PROGRAM_BACK||d==p.SCENE_PROFILE||d==p.SCENE_CUSTOM_MENU||d==p.SCENE_APP_SHARE_MESSAGE||d==p.SCENE_TEMPLETE_MESSAGE)&&(b.referrerInfo=_extends({},a.referrerInfo),d==p.SCENE_MINI_PROGRAM||d==p.SCENE_MINI_PROGRAM_BACK))try{b.referrerInfo.extraData=JSON.parse(b.referrerInfo.extraData||'{}')}catch(a){b.referrerInfo.extraData={}}}}return b}function c(a){return{type:e.SIMULATOR_SET_BACKGROUND,data:a}}const d=require('path'),e=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),f=require('./15ba1827c7f6564a45df6bd44da3a977.js'),g=require('./3bfffbe88b3d923921f851c0697974fe.js'),h=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),i=require('./1bd2563d13db26950ae47494b2c34454.js'),{checkReservedDirectories:j}=require('./fba5323ca1afcd71487791d6c5856665.js'),k=require('./f171257bbcaef547a3cf27266ccb0db2.js'),l=require('./72653d4b93cdd7443296229431a7aa9a.js'),m=require('./35a5c665bbd039baf968211c3ff216fc.js'),n=require('./f7806acc0e6f141f3b11c7faf34d32ad.js'),o=require('./83822ab95828f61bf6a61c04d53246a8.js'),p=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),q=require('./da7c31daaf542cf1796023d8e344b98a.js'),r=require('./2dfc6a3df6d6fc51266b293c8420e88b.js'),s=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),t=require('./common/locales/index.js'),u=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),v=require('./fc137838572a83604db39acff8e909e0.js'),w=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),x=require('./a81bc67025235ccc252f27ad624704e9.js'),y=require('./fbb55aa732a5fdce7b8e14171c2b3361.js'),z=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),A=require('./633001216e9782bc5ed307a07380083e.js'),B=require('./a78e6d6a87de1708226375ca4c320d76.js'),{getOriginalPageOrientationObject:C,shouldSimulatorRotate:D,DEFAULT_ORIENTATION:E}=require('./a3d662b5798bbb27bf21be3e3587a588.js'),F=(a,b)=>({type:e.SIMULATOR_LOAD_SUBPACKAGE,data:{root:a,loaded:b}}),G=(a={})=>{const b=g.getCurrent(),c=b.appid,d=a.origin;return d==s.COMPILE_ORIGIN.SAVE_FILE?q('weapp_filechange_compile',c):d==s.COMPILE_ORIGIN.BUTTON?q('weapp_toolbar_compile',c):d==s.COMPILE_ORIGIN.SHORT_CUT&&q('weapp_key_compile',c),async(c)=>{await B.disableAllAttached('simulator'),(d==s.COMPILE_ORIGIN.BUTTON||d==s.COMPILE_ORIGIN.SHORT_CUT)&&b.setting&&b.setting.scriptsEnable&&b.scripts&&b.scripts.beforeCompile?A(c,a,{command:b.scripts.beforeCompile,options:{cwd:b.projectpath,shell:!0}}):c({type:e.SIMULATOR_COMPILE,data:a})}};module.exports={launch:function(){return a(),async(a,c)=>{try{const f=g.getCurrent()||{},i=c(),k=await h(f);try{j(f)}catch(a){r.display({command:s.DISPLAY_ERROR,data:{error:a}})}const l=k.extAppid||f.appid,m=k.entryPagePath.replace(/\.html$/,'');let n=!1;f.runtimeAttr&&f.runtimeAttr.appid===l||(a(u.setProjectRuntimeAttr({appid:l})),await u.requestProjectAttr(!0)(a));const o=b(i.simulator.compileCommand);o.path=o.path||m;const{rotated:p}=i.toolbar,q=p?'landscape':'portrait',x=C(k,o.path,E),y=D({originalPageOrientation:q,lastPageOrientation:q},x);y?a(v.setDeviceRotated(!i.toolbar.rotated)):a(v.setDeviceRotated(i.toolbar.rotated));const z=o.path;m!=z&&(n=!0);let A=!1;if(-1===k.pages.indexOf(z)){const b=w.checkIsInSubPackage(k,z);if(!b)A=!0;else{let c=!1;b.pages.forEach((a)=>{d.posix.join(b.root,a)==z&&(c=!0)}),c?setTimeout(()=>{a(F(b.root,!1))}):A=!0}}A&&r.display({command:s.DISPLAY_ERROR,data:{title:t.config.JSON_CUSTOM_COMPILE_PATH_NOT_EXISTS_TITLE,error:{message:t.config.JSON_CUSTOM_COMPILE_PATH_NOT_EXISTS.format(z)}}}),a({type:e.SIMULATOR_LAUNCH,data:{home:n,pathName:z,query:o.query,scene:o.scene,appLaunchInfo:o,isEntryPage:!0,pageNotFound:A,initialDeviceOrientation:c().toolbar.rotated?'landscape':'portrait'},appConfig:k})}catch(a){l.error(`simulator launch error ${a}`)}}},setAppLaunched:(a)=>(b)=>{a&&b({type:e.SIMULATOR_SET_APP_LAUNCHED,flag:a})},setWebviewReady:function(a,b){return{type:e.SIMULATOR_SET_WEBVIEW_READY,webviewID:a,ready:b}},hidePreviewImage:function(){return{type:e.SIMULATOR_SET_PREVIEW_IMAGE,data:{show:!1}}},hideActionSheet:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.SIMULATOR_SET_ACTIONSHEET,data:{show:!1,callbackID:null,showOnWebviewID:-1}}),a&&d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},hideModal:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.SIMULATOR_UNSET_MODAL,data:{callbackID:a}}),a&&d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},hidePicker:function({callbackID:a,webviewID:b,res:c}){return(d)=>{d({type:e.SIMULATOR_SET_PICKER,data:{show:!1}}),a&&d({type:e.JSSDK_CALLBACK,callbackID:a,webviewID:b,res:c})}},hideShare:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.SIMULATOR_SET_SHARE,data:{show:!1}}),a&&d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},hideGroupList:function(a){return(b)=>{b({type:e.SIMULATOR_SET_GROUP_INFO,data:{show:!1}}),a&&b({type:e.SIMULATOR_SET_SHARE,data:{show:!0,group:a}})}},setDebuggee:function(a,b,c){return{type:e.SIMULATOR_SET_DEBUGGEE,debuggee:a,webviewID:b,flag:c}},hideConfirm:function(){return{type:e.SIMULATOR_SET_CONFIRM,data:{show:!1,content:'',callback:()=>{}}}},hideSetting:function({scopeList:a,callbackID:b,api:c}){return async(d)=>{let h='';if(a&&0<a.length)try{const{body:b}=await f({url:`${k.setAuth}`,method:'post',body:JSON.stringify({appid:g.getProjectAppID(),auth_item:a}),needToken:1,needAppID:1})}catch(a){l.error(`hideSetting setAuth error ${a}`),h=a}const i={};if(h)i.errMsg=`${c}:fail ${h}`;else{const b=a.map((a)=>({state:a.state,scope:a.scope,desc:a.scope_desc}));i.errMsg=`${c}:ok`,i.authSetting=b}d({type:e.SIMULATOR_SET_SETTING,data:{show:!1}}),d({type:e.ASSDK_CALLBACK,callbackID:b,res:i,api:c})}},hideAddPhoneContact:function({confirm:a=!1,callbackID:b=-1,api:c=''}={}){return(d)=>{d({type:e.SIMULATOR_SET_ADDPHONECONTACT,data:{show:!1,contactData:{}}});let f;f=a?{errMsg:`${c}:ok`}:{errMsg:`${c}:fail cancel`},d({type:e.ASSDK_CALLBACK,callbackID:b,res:f,api:c})}},hideChooseAddress:function({confirm:a=!1,callbackID:b=-1,api:c=''}={}){return(d)=>{d({type:e.SIMULATOR_SET_CHOOSEADDRESS,data:{show:!1}});let f;f=a?{errMsg:`${c}:ok`,addressPostalCode:'510000',proviceFirstStageName:t.config.PROVINCE_PLACEHOLDER,addressCitySecondStageName:t.config.CITY_PLACEHOLDER,addressCountiesThirdStageName:t.config.COUNTY_PLACEHOLDER,addressDetailInfo:t.config.ADDRESS_DETAIL_PLACEHOLDER,userName:t.config.NAME_PLACEHORDER,nationalCode:'510000',telNumber:'020-81167888'}:{errMsg:`${c}:fail cancel`},d({type:e.ASSDK_CALLBACK,callbackID:b,res:f,api:c})}},hideChooseInvoiceTitle:function({confirm:a=!1,callbackID:b=-1,api:c=''}={}){return(d)=>{d({type:e.SIMULATOR_SET_CHOOSEINVOICETITLE,data:{show:!1}});let f;f=a?{errMsg:`${c}:ok`,invoiceTitleInfo:JSON.stringify({type:0,title:t.config.GUANGZHOU_TENCENT,taxNumber:'91440101327598294H',companyAddress:t.config.COMPANY_ADDRESS_PLACEHORDER,telephone:'020-81167888',bankName:t.config.BANKNAME_PLACEHORDER,bankAccount:'1209 0928 2210 301'})}:{errMsg:`${c}:fail cancel`},d({type:e.ASSDK_CALLBACK,callbackID:b,res:f,api:c})}},setAppRoute:function(a){return{type:e.SIMULATOR_SET_APP_ROUTE,data:a}},switchTab:function(a,b){return{type:e.SIMULATOR_OPEN_TABBAR,data:{pathName:a,tabbarIndex:b}}},setAuthorize:function(a){return{type:e.SIMULATOR_SET_AUTHORIZE_CONFIRM,data:{show:a}}},setShareDataURI:function(a,b){return{type:e.SIMULATOR_SET_SHARE_DATAURI,data:{webviewID:a,dataURI:b}}},setRightBtnActionSheet:function(a){return{type:e.SIMULATOR_SET_RIGHTBTN_ACTIONSHEET,data:a}},setPayment:function(a){return{type:e.SIMULATOR_SET_PAYMENT_QRWND,data:a}},hideMap:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.SIMULATOR_SET_LOCATION,data:{show:!1,callbackID:null,src:''}}),a&&d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},hideCardView:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.SIMULATOR_SET_CARD_VIEW,data:{show:'none',cardInfo:[]}}),a&&d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},batchAddCard:function({callbackID:a,list:b}){return(c)=>{const d={appid:g.getProjectAppID(),acceptitem_list:b},h={url:`${k.batchAddCardURL}?isapp=1`,body:JSON.stringify(d),method:'post',needToken:1,needAppID:1};f(h).then((d)=>{const f=d.body;let g=f.resp_list;g=g.map((a,c)=>{const d=b[c],e=JSON.parse(a.json_ret);return{cardId:d.card_id,cardExt:d.card_ext,code:e.encrypt_code,isSuccess:!0}}),c({type:e.ASSDK_CALLBACK,callbackID:a,res:{errMsg:'addCard:ok',cardList:g},api:'addCard'})}).catch((b)=>{c({type:e.ASSDK_CALLBACK,callbackID:a,res:{errMsg:`addCard:fail ${b}`},api:'addCard'})}),c({type:e.SIMULATOR_SET_CARD_VIEW,data:{show:'none',cardInfo:[]}})}},setBackground:c,toggleBackground:function(){return{type:e.SIMULATOR_TOGGLE_BACKGROUND}},setWidget:function(a){return{type:e.SIMULATOR_SET_WIDGET,data:a}},setGame:function(a){return{type:e.SIMULATOR_SET_GAME,data:a}},reLaunchToIndexPage:function(){return{type:e.SIMULATOR_RELAUNCH_TO_INDEX}},setWxmlInspect:function(a){return{type:e.SIMULATOR_SET_WXMLINSPECT,data:a}},setVibrate:function(a){return{type:e.SIMULATOR_SET_VIBRATE,data:{type:a}}},insertHTMLWebView:function({callbackID:a,webviewID:b,res:c}){return(d)=>{a&&d({type:e.JSSDK_CALLBACK,callbackID:a,webviewID:b,res:c})}},updateHTMLWebView:function({callbackID:a,webviewID:b,res:c}){return(d)=>{a&&d({type:e.JSSDK_CALLBACK,callbackID:a,webviewID:b,res:c})}},compile:(a={})=>{return(b,c)=>{const d=c();if(!global.isSimple&&!global.autoTest){const b=d.settings.edit.saveBeforeCompile,c=a.origin===s.COMPILE_ORIGIN.BUTTON||a.origin===s.COMPILE_ORIGIN.SHORT_CUT;let e=null;if(b&&c?e='saveAllAndInitiativeCompile':b?e='saveAllAndCompile':c&&(e='initiativeCompile'),e)return o.ready=!0,void o.send({type:'COMMAND',data:a.origin,command:e})}b(G(a))}},compileImmediate:G,setConfirm:function(a){return{type:e.SIMULATOR_SET_CONFIRM,data:a}},setSubPackage:F,setGameSubPackage:(a,b)=>({type:e.SIMULATOR_LOAD_GAME_SUBPACKAGE,data:{root:a,loaded:b}}),assdkCallback:function({callbackID:a,res:b,api:c}){return(d)=>{d({type:e.ASSDK_CALLBACK,callbackID:a,res:b,api:c})}},widgetJumpToWeapp:function(a){return(b)=>{b({type:e.PROJECT_SET_COMPILE_TYPE,data:z.weapp}),b({type:e.SIMULATOR_COMPILE,data:a})}},simulatorReset:a,gameLaunch:function(){return a(),async(a,c)=>{try{const d=c(),f=g.getCurrent()||{},h=await i(f);d.simulator.appConfig.resizable!==h.resizable&&a(v.setDeviceRotated(!1));const j=b(d.simulator.compileCommand);a({type:e.SIMULATOR_GAME_LAUNCH,data:{appLaunchInfo:j},appConfig:h})}catch(a){l.error(`simulator game launch error ${a}`)}}},hideKeyboard:function(){return{type:e.SIMULATOR_SET_KEYBOARD,data:{show:!1}}},setSimulateUpdate:(a)=>(b)=>{b({type:e.SIMULATOR_SET_SIMULATE_UPDATE,simulateUpdate:a})},setAnyHTMLWebView:function(a){return(b)=>{b({type:e.SIMULATOR_SET_ANY_HTMLWEBVIEW,data:a})}},simulatorBack:function(){return(a,b)=>{const d=b(),{simulator:f}=d,g=f.currentWebviewID,h=f.webviewInfos[g];f.anyHtmlWebviewInfo||h&&-1!=h.parent?a({type:e.SIMULATOR_NAVIGATE_BACK,delta:1}):a(c({show:!0}))}},cleanExitingWebview:()=>{return{type:e.SIMULATOR_CLEAN_EXITING_WEBVIEW}}}}(require('lazyload'),require);